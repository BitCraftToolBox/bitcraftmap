<!DOCTYPE html>
<html>
	<head>
		<title>Bitcraft Game Map</title>
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" crossorigin=""/>

		<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" crossorigin=""></script>
    <script src="https://rawgit.com/kawanet/msgpack-lite/master/dist/msgpack.min.js" crossorigin=""></script>
    <script src="https://cdn.jsdelivr.net/npm/leaflet-canvas-marker@0.2.0/dist/leaflet.canvas-markers.min.js" crossorigin=""></script>


		<style>
			#map {
				height: 100vh;
				width: 100%;
        background-color: #222d44;
			}
    </style>
	</head>

	<body>
		<div id="map"></div>
		

		<script>
			const imageWidth = 7676;
			const imageHeight = 7676;
			const imageBounds = [[0, 0], [imageHeight, imageWidth]];
			
			const map = L.map('map', {
				crs: L.CRS.Simple,
				minZoom: -10,
				maxZoom: 10,
				zoomSnap: 0.1,
			});
			
			map.fitBounds(imageBounds);
			L.imageOverlay('assets/maps/map.png', imageBounds).addTo(map);



      function createMapIcon(iconUrl) {
        return L.icon({
          iconUrl: iconUrl,
          iconSize: [32, 32],
          iconAnchor: [16, 16],
          popupAnchor: [0, -16],
          shadowUrl: null,
          shadowSize: null,
          shadowAnchor: null
        });
      }
 
      const caveIcons = [
        createMapIcon('assets/icons/FerralithOreChunk.webp'),
        createMapIcon('assets/icons/PyreliteOreChunk.webp'),
        createMapIcon('assets/icons/EmariumOreChunk.webp'),
        createMapIcon('assets/icons/ElenvarOreChunk.webp'),
        createMapIcon('assets/icons/LuminiteOreChunk.webp'),
        createMapIcon('assets/icons/RathiumOreChunk.webp'),
        createMapIcon('assets/icons/AurumiteOreChunk.webp'),
        createMapIcon('assets/icons/CelestiumOreChunk.webp'),
        createMapIcon('assets/icons/UmbraciteOreChunk.webp'),
        createMapIcon('assets/icons/AstraliteOreChunk.webp')
      ];

      const oreTier = [
        'Ferralith',
        'Pyrelite',
        'Emarium',
        'Elenvar',
        'Luminite',
        'Rathium',
        'Aurumite',
        'Celestium',
        'Umbracite',
        'Astralite'
      ]

      const caveSize = [
        'Small',
        'Large'
      ]

      // const ruinedCities = L.layerGroup();
      // const playerClaims = L.layerGroup();
      // const empireTowers = L.layerGroup();
      // const temples = L.layerGroup();
      // const wonders = L.layerGroup();

      const caves = L.canvasIconLayer({}).addTo(map);

      fetch('assets/markers/caves.msgpack')
        .then(response => response.arrayBuffer())
        .then(buffer => {
          const data = msgpack.decode(new Uint8Array(buffer));

          data.forEach(cave => {
            L.marker(
              [ cave.e * 7676 / 1.1547005, cave.n * 7676 ], 
              { icon: caveIcons[cave[1]-1] }
            )
            .addTo(caves)
            .bindPopup( caveSize[cave[2]] + ' ' + oreTier[cave[1]] + ' Cave ' + '(T' + cave[1] + ')');
          });
        })
        .catch(error => console.error("Error loading or decoding MsgPack:", error));


		</script>
	</body>
</html>
